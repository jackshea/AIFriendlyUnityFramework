# AI å‹å¥½ Unity å¼€å‘æ¡†æ¶è®¾è®¡

è®¾è®¡ä¸€ä¸ªâ€œAIå‹å¥½â€çš„Unityæ¡†æ¶ï¼Œæ ¸å¿ƒæ€è·¯ä¸ä¼ ç»Ÿæ¡†æ¶æœ‰æ‰€ä¸åŒã€‚ä¼ ç»Ÿæ¡†æ¶å¯èƒ½è¿½æ±‚æè‡´çš„æ€§èƒ½æˆ–æåº¦çš„çµæ´»æ€§ï¼Œè€Œ**AIå‹å¥½å‹æ¡†æ¶çš„æ ¸å¿ƒæ˜¯ï¼šé«˜å†…èšã€ä½è€¦åˆã€æ˜¾å¼ä¾èµ–ã€å¼ºç±»å‹çº¦æŸä»¥åŠå®Œå–„çš„ä¸Šä¸‹æ–‡è§„èŒƒ**ã€‚

Claude Code è¿™ç±»åŸºäºå‘½ä»¤è¡Œçš„AI Agentï¼Œå…¶ä¼˜åŠ¿åœ¨äºå¿«é€Ÿç”Ÿæˆä»£ç ã€è·¨æ–‡ä»¶é‡æ„å’Œè‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œä½†åŠ£åŠ¿åœ¨äºå®¹æ˜“åœ¨â€œé¢æ¡ä»£ç â€ï¼ˆSpaghetti Codeï¼‰æˆ–åºå¤§çš„å•ä½“è„šæœ¬ä¸­è¿·å¤±ä¸Šä¸‹æ–‡ã€‚

ä»¥ä¸‹ä¸ºæ‚¨æä¾›ä¸€ä»½ä»é›¶å¼€å§‹çš„è¯¦ç»†è®¾è®¡æ–‡æ¡£ï¼Œä¸“ä¸ºé€‚é… Claude Code é©±åŠ¨çš„å¼€å‘æµç¨‹è€Œæ‰“é€ ã€‚

------

## ğŸ“‘ AIå‹å¥½å‹Unityå¼€å‘æ¡†æ¶è®¾è®¡æ–‡æ¡£

### 1. æ ¸å¿ƒè®¾è®¡åŸåˆ™ (AI-First Principles)

- **å•ä¸€èŒè´£åŸåˆ™ (SRP) æç®€åŒ–**ï¼šæ¯ä¸ªè„šæœ¬åªåšä¸€ä»¶äº‹ï¼Œè¡Œæ•°å°½é‡æ§åˆ¶åœ¨200è¡Œä»¥å†…ã€‚è¿™èƒ½ç¡®ä¿ä»£ç å®Œå…¨é€‚é…AIçš„ä¸Šä¸‹æ–‡çª—å£ï¼Œé™ä½AIäº§ç”Ÿå¹»è§‰çš„æ¦‚ç‡ã€‚
- **æ˜¾å¼ä¾èµ–æ³¨å…¥ (DI)**ï¼šåšå†³æŠµåˆ¶å…¨å±€å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰ã€‚ä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼ˆæ¨è **VContainer** æˆ– **Zenject**ï¼ŒVContaineræ›´è½»é‡ä¸”AIæ˜“è¯»ï¼‰ï¼Œè®©AIåœ¨æ„é€ å‡½æ•°æˆ–Injectæ–¹æ³•ä¸­ä¸€çœ¼çœ‹å‡ºæ¨¡å—ä¾èµ–ã€‚
- **å¥‘çº¦å¼ç¼–ç¨‹ (Interface-Driven)**ï¼šå…ˆå†™æ¥å£ï¼Œå†å†™å®ç°ã€‚è¿™å…è®¸ä½ é€šè¿‡æä¾›æ¥å£å¥‘çº¦æ¥ç»™ Claude Code ä¸‹è¾¾æ˜ç¡®çš„ä»»åŠ¡æŒ‡ä»¤ã€‚
- **é¢å‘æ–‡æœ¬ä¸æ•°æ®é©±åŠ¨**ï¼šé…ç½®æ•°æ®å°½é‡ä½¿ç”¨ JSONã€YAML æˆ–æ¸…æ™°çš„ ScriptableObjectï¼Œé¿å…åœ¨ Inspector ä¸­è¿›è¡Œå¤æ‚çš„åµŒå¥—æ‹–æ‹½ï¼ˆAIæ— æ³•ç›´æ¥ç‚¹å‡»Inspectorï¼Œä½†èƒ½ä¿®æ”¹æ–‡æœ¬é…ç½®å’Œä»£ç ï¼‰ã€‚
- **AIè§„åˆ™å†…åŒ–**ï¼šåœ¨é¡¹ç›®æ ¹ç›®å½•æ”¾ç½® `.clauderc` æˆ– `AI_RULES.md`ï¼Œè®© Claude Code åœ¨å¯åŠ¨æ—¶è¯»å–æ¡†æ¶çš„å‘½åè§„èŒƒå’Œæ¶æ„è§„åˆ™ã€‚

------

### 2. æ¶æ„åˆ†å±‚è®¾è®¡

ä¸ºäº†è®© Claude Code èƒ½å¤Ÿå±€éƒ¨ä¿®æ”¹è€Œä¸å¼•å‘å…¨å±€å´©æºƒï¼Œæ¡†æ¶å¿…é¡»ä¸¥æ ¼åˆ†å±‚ï¼š

#### å±‚çº§ 1: Core (æ ¸å¿ƒå±‚)

- **åŠŸèƒ½**ï¼šä¸æ¸¸æˆé€»è¾‘æ— å…³çš„åº•å±‚åŸºå»ºã€‚
- **å†…å®¹**ï¼šä¾èµ–æ³¨å…¥å®¹å™¨å°è£…ã€å…¨å±€äº‹ä»¶æ€»çº¿ (EventBus)ã€å¯¹è±¡æ±  (ObjectPool)ã€æ—¥å¿—ç³»ç»Ÿ (Logger)ã€æ‰©å±•æ–¹æ³• (Extensions)ã€‚
- **AIäº¤äº’**ï¼šè¿™ä¸€å±‚ç›¸å¯¹ç¨³å®šï¼Œä¸»è¦ç”±ä½ ä¸»å¯¼è®¾è®¡ï¼Œå®Œæˆåå‘Šè¯‰ Claude Code â€œä¸è¦ä¿®æ”¹Coreå±‚ï¼Œç›´æ¥è°ƒç”¨â€ã€‚

#### å±‚çº§ 2: Services/Systems (æœåŠ¡å±‚)

- **åŠŸèƒ½**ï¼šæä¾›æ¸¸æˆåŸºç¡€èƒ½åŠ›ï¼Œç‹¬ç«‹è¿ä½œã€‚
- **å†…å®¹**ï¼šèµ„æºç®¡ç† (Addressableså°è£…)ã€UIç®¡ç† (UIManager)ã€éŸ³é¢‘ç®¡ç† (AudioManager)ã€ç½‘ç»œ/å­˜æ¡£æ¨¡å—ã€‚
- **AIäº¤äº’**ï¼šè®© Claude Code åŸºäº Core å±‚çš„ EventBus å’Œ DI å®¹å™¨æ¥ç”Ÿæˆè¿™äº›æœåŠ¡ã€‚

#### å±‚çº§ 3: Gameplay/Features (ç©æ³•å±‚)

- **åŠŸèƒ½**ï¼šå…·ä½“çš„æ¸¸æˆé€»è¾‘ã€‚
- **å†…å®¹**ï¼šè§’è‰²æ§åˆ¶ã€æ•ŒäººAIã€å…³å¡æµç¨‹ã€‚
- **AIäº¤äº’**ï¼šè¿™æ˜¯ Claude Code çš„ä¸»æˆ˜åœºã€‚ä½ å¯ä»¥é«˜é¢‘åœ°è®©å®ƒâ€œåˆ›å»ºä¸€ä¸ªå…·æœ‰Xè¡Œä¸ºçš„æ€ªç‰©æ§åˆ¶å™¨ï¼Œç»§æ‰¿è‡ª `IEnemyController`ï¼Œå¹¶ç›‘å¬ç©å®¶ç§»åŠ¨äº‹ä»¶â€ã€‚

------

### 3. é¡¹ç›®ç›®å½•ç»“æ„è§„èŒƒ

æ ‡å‡†åŒ–ä¸”å¸¦æœ‰æè¿°æ€§çš„ç›®å½•ç»“æ„ï¼Œèƒ½å¤§å¹…æé«˜ Claude Code çš„æ–‡ä»¶æ£€ç´¢å‡†ç¡®ç‡ï¼š

Plaintext

```
Assets/
â”œâ”€â”€ AI_RULES.md             // ç»™Claude Codeçœ‹çš„æ¡†æ¶è§„åˆ™ï¼ˆé‡è¦ï¼ï¼‰
â”œâ”€â”€ App/                    // åº”ç”¨ç¨‹åºå…¥å£ç‚¹ (DIå®‰è£…å™¨ã€å¯åŠ¨è„šæœ¬)
â”œâ”€â”€ Core/                   // æ ¸å¿ƒåº•å±‚ (äº‹ä»¶æ€»çº¿ã€å¯¹è±¡æ± ã€å·¥å…·ç±»)
â”œâ”€â”€ Services/               // ç‹¬ç«‹æœåŠ¡ (UIç®¡ç†ã€éŸ³é¢‘ã€å­˜æ¡£)
â”œâ”€â”€ Features/               // ç©æ³•ç³»ç»Ÿ (æŒ‰åŠŸèƒ½æ¨¡å—åˆ’åˆ†ï¼ŒéæŒ‰æ–‡ä»¶ç±»å‹åˆ’åˆ†)
â”‚   â”œâ”€â”€ Combat/             //   - æˆ˜æ–—æ¨¡å— (åŒ…å«Scripts, Prefabs, SO)
â”‚   â”œâ”€â”€ Inventory/          //   - èƒŒåŒ…æ¨¡å—
â”‚   â””â”€â”€ Movement/           //   - ç§»åŠ¨æ¨¡å—
â”œâ”€â”€ Res/                    // åŠ¨æ€åŠ è½½èµ„æº (Addressables / Resources)
â””â”€â”€ Tests/                  // å•å…ƒæµ‹è¯•ä¸é›†æˆæµ‹è¯• (å¼ºè¿«AIå†™æµ‹è¯•)
```

> **æœ€ä½³å®è·µï¼š** é‡‡ç”¨**Feature-basedï¼ˆåŸºäºåŠŸèƒ½ï¼‰**çš„ç›®å½•ç»“æ„ï¼Œè€Œä¸æ˜¯ä¼ ç»Ÿçš„æŒ‰ç±»å‹ï¼ˆScripts, Prefabs, Materialsï¼‰åˆ†ç±»ã€‚è¿™æ · Claude Code åœ¨ä¿®æ”¹â€œæˆ˜æ–—æ¨¡å—â€æ—¶ï¼Œåªéœ€è¦åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹å†…æŸ¥æ‰¾ä¸Šä¸‹æ–‡ã€‚

------

### 4. ç»™ Claude Code çš„ç¯å¢ƒé…ç½® (`AI_RULES.md` ç¤ºä¾‹)

åœ¨æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª `AI_RULES.md`ï¼Œå¹¶åœ¨è®© Claude Code å¼€å§‹å·¥ä½œå‰æé†’å®ƒé˜…è¯»ã€‚

> **AI_RULES.md å†…å®¹ç¤ºä¾‹ï¼š**
>
> 1. **æ¶æ„è§„åˆ™**ï¼šç¦æ­¢ä½¿ç”¨å•ä¾‹æ¨¡å¼ã€‚æ‰€æœ‰æœåŠ¡å¿…é¡»é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ï¼ˆä½¿ç”¨VContainerï¼‰ã€‚
> 2. **äº‹ä»¶é€šä¿¡**ï¼šè·¨æ¨¡å—é€šä¿¡å¿…é¡»ä½¿ç”¨ `Core.EventBus` é‡Œçš„ `EventBus.Publish<T>()` å’Œ `EventBus.Subscribe<T>()`ã€‚
> 3. **å‘½åè§„èŒƒ**ï¼šæ¥å£ä»¥ `I` å¼€å¤´ï¼›ç§æœ‰å˜é‡ä»¥ `_` å¼€å¤´ä½¿ç”¨é©¼å³°å¼ï¼›æ–¹æ³•åä½¿ç”¨ PascalCaseã€‚
> 4. **UIè§„åˆ™**ï¼šUIé€»è¾‘å¿…é¡»ä¸è¡¨ç°åˆ†ç¦»ï¼Œé‡‡ç”¨ MVP æ¨¡å¼ã€‚Viewåªè´Ÿè´£ç»‘å®šç»„ä»¶ï¼ŒPresenterè´Ÿè´£é€»è¾‘ã€‚
> 5. **æ³¨é‡Šè§„èŒƒ**ï¼šä¸ºæ‰€æœ‰å…¬å…±æ¥å£å’Œç±»ç”Ÿæˆ XML Summary æ³¨é‡Šã€‚

------

### 5. æ ¸å¿ƒç»„ä»¶è®¾è®¡æ¨¡æ¿ (AI å‹å¥½çš„ä»£ç èŒƒå¼)

ä¸ºäº†è®©AIæœ‰æ®å¯ä¾ï¼Œä½ éœ€è¦å…ˆæ­å¥½å‡ ä¸ªåŸºç±»æˆ–æ¨¡æ¿ã€‚

**A. è§£è€¦çš„äº‹ä»¶æ€»çº¿ (Event Bus)**

AI åªéœ€è¦çŸ¥é“æŠ›å‡ºäº‹ä»¶å’Œç›‘å¬äº‹ä»¶ï¼Œä¸éœ€è¦çŸ¥é“ç›®æ ‡æ˜¯è°ã€‚

C#

```
public struct PlayerDamagedEvent { public int Damage; }

// AI ç”Ÿæˆçš„æ”»å‡»é€»è¾‘
EventBus.Publish(new PlayerDamagedEvent { Damage = 10 });

// AI ç”Ÿæˆçš„UIé€»è¾‘
EventBus.Subscribe<PlayerDamagedEvent>(e => UpdateHealthUI(e.Damage));
```

**B. UI MVP æ¨¡å¼æ¨¡æ¿**

è®© Claude Code æ˜ç™½å®ƒåœ¨å†™UIæ—¶ï¼Œä¸èƒ½æŠŠä¸šåŠ¡é€»è¾‘å¡è¿› MonoBehaviour é‡Œã€‚

C#

```
// View (ç”±å¼€å‘è€…æ‹–æ‹½èµ‹å€¼ï¼ŒAIåªè´Ÿè´£ç”Ÿæˆä»£ç å¹¶æä¾›æŒ‚è½½è¯´æ˜)
public class LoginView : MonoBehaviour 
{
    public Button LoginBtn;
    public TMP_InputField AccountInput;
}

// Presenter (è¿™æ˜¯çº¯C#ç±»ï¼ŒAIéå¸¸æ“…é•¿å†™è¿™ä¸ªï¼Œæ–¹ä¾¿å•å…ƒæµ‹è¯•)
public class LoginPresenter
{
    private readonly LoginView _view;
    private readonly IAuthService _auth;

    public LoginPresenter(LoginView view, IAuthService auth) // DI æ³¨å…¥
    {
        _view = view;
        _auth = auth;
        _view.LoginBtn.onClick.AddListener(OnLoginClicked);
    }
}
```

------

### 6. æ­é… Claude Code çš„æ ‡å‡†å¼€å‘å·¥ä½œæµ

åœ¨å®é™…å¼€å‘ä¸­ï¼Œå»ºè®®é‡‡ç”¨ä»¥ä¸‹åä½œå¾ªç¯ï¼š

1. **å®šä¹‰æ¥å£ (Human)**ï¼šä½ å…ˆå†™å‡ºä¸€ä¸ªæ¸…æ™°çš„æ¥å£ï¼ˆä¾‹å¦‚ `IInventorySystem.cs`ï¼‰å¹¶å†™å¥½æ³¨é‡Šï¼Œè§„å®šå¥½è¾“å…¥è¾“å‡ºã€‚
2. **ç”Ÿæˆå®ç° (Claude Code)**ï¼šåœ¨ç»ˆç«¯ä¸­è¾“å…¥æŒ‡ä»¤ï¼šâ€œ*é˜…è¯» `IInventorySystem.cs`ï¼Œåœ¨ `Features/Inventory` ç›®å½•ä¸‹ç”Ÿæˆå…¶å…·ä½“å®ç° `InventorySystem.cs`ï¼Œä½¿ç”¨ VContainer è¿›è¡Œä¾èµ–æ³¨å…¥ï¼Œå¹¶å¤„ç†ç‰©å“è¶…å‡ºå®¹é‡çš„å¼‚å¸¸æƒ…å†µã€‚*â€
3. **ç”Ÿæˆæµ‹è¯• (Claude Code)**ï¼šâ€œ*é’ˆå¯¹ä½ åˆšå†™çš„ `InventorySystem.cs`ï¼Œåœ¨ `Tests/EditMode` ä¸­ç”Ÿæˆä¸€å¥— NUnit å•å…ƒæµ‹è¯•ï¼Œè¦†ç›–æ·»åŠ ç‰©å“ã€ç§»é™¤ç‰©å“å’Œå®¹é‡æº¢å‡ºæµ‹è¯•ã€‚*â€
4. **æ ¡éªŒä¸é‡æ„ (Human & Claude Code)**ï¼šå¦‚æœåœ¨ Unity ä¸­è¿è¡ŒæŠ¥é”™ï¼Œå°†æŠ¥é”™çš„ Console Stacktrace ç›´æ¥ç²˜è´´ç»™ Claude Codeï¼Œè®©å®ƒè‡ªè¡Œä¿®å¤ã€‚

------

æˆ‘ä»¬å¯ä»¥å…ˆä»æ­å»ºæœ€æ ¸å¿ƒçš„åº•å±‚ï¼ˆDIæ¡†æ¶å¼•å…¥å’ŒEventBusï¼‰å¼€å§‹ã€‚æ‚¨æ˜¯å¸Œæœ›æˆ‘ä¸ºæ‚¨æä¾›ä¸€å¥—æœ€ç®€ã€å…æ’ä»¶çš„è½»é‡çº§ EventBus å®ç°ä»£ç ä½œä¸ºæ¡†æ¶çš„èµ·ç‚¹ï¼Œè¿˜æ˜¯æƒ³å…ˆè®¨è®ºä¾èµ–æ³¨å…¥ï¼ˆå¦‚VContainerï¼‰çš„é›†æˆæ–¹æ¡ˆï¼Ÿ